//http://docs.kissyui.com/kissy/src/switchable/demo.html
(function(w,B){function h(a,b){b=b||{};if(!("markupType"in b))if(b.panelCls)b.markupType=1;else if(b.panels)b.markupType=2;for(var e=this.constructor;e;)b=c.extend({},e.Config,b),e=e.superclass?e.superclass.constructor:null;this.container=c(a)[0];this.config=b;this.activeIndex=this.completedIndex=b.activeIndex;if(!(this.activeIndex>-1)&&typeof b.switchTo!="number")this.completedIndex=this.activeIndex=0;this._init();this._initPlugins();c(this).trigger(C);this.activeIndex>-1||typeof b.switchTo=="number"&&
this.switchTo(b.switchTo)}function q(a){var b={};b.type=a.originalEvent.type;b.target=a.originalEvent.target||a.originalEvent.srcElement;return{originalEvent:b}}function D(a,b,e,f,d){var g=this,a=g.config,b=g.length,i=g.activeIndex,j=a.scrollType===k,n=j?r:x,h=g.viewSize[j?0:1],j=-h*f,l={},o,t=d===s;(o=t&&i===0&&f===b-1||d===u&&i===b-1&&f===0)&&(j=E.call(g,g.panels,f,t,n,h));l[n]=j+y;g.anim&&c(g.anim.fromEl).stop(true);g.anim={};c(g.content).stop(true).animate(l,a.duration*1E3,a.easing,function(){o&&
F.call(g,g.panels,f,t,n,h);g.anim=void 0;e()})}function E(a,b,e,f,d){var g=this.config.steps,b=this.length,i=e?b-1:0,j=(i+1)*g;for(g*=i;g<j;g++)c(a[g]).css(p,z),c(a[g]).css(f,(e?-1:1)*d*b);return e?d:-d*b}function F(a,b,e,f,d){var g=this.config.steps,b=this.length,i=e?b-1:0,j=(i+1)*g;for(g*=i;g<j;g++)c(a[g]).css(p,v),c(a[g]).css(f,v);c(this.content).css(f,e?-d*(b-1):v)}var c=B,A=w.document,p="position",z="relative",k="scrollx",r="left",x="top",y="px",v="",u="forward",s="backward",m,C="init",G={originalEvent:{target:1}};
c.extend({inherit:function(a,b,e,f){if(!b||!a)return a;var d=Object.create?function(a,b){return Object.create(a,{constructor:{value:b}})}:function(a,b){function c(){}c.prototype=a;var e=new c;e.constructor=b;return e},g=b.prototype,i;i=d(g,a);a.prototype=c.extend(i,a.prototype);a.superclass=d(g,b);e&&c.extend(i,e);f&&c.extend(a,f);return a},fnbind:function(a,b){var c=[].slice,f=c.call(arguments,2),d=function(){},g=function(){return a.apply(this instanceof d?this:b,f.concat(c.call(arguments)))};d.prototype=
a.prototype;g.prototype=new d;return g}});h.Config={markupType:0,navCls:"ks-switchable-nav",contentCls:"ks-switchable-content",triggerCls:"ks-switchable-trigger",panelCls:"ks-switchable-panel",triggers:[],panels:[],hasTriggers:true,triggerType:"mouse",delay:0.1,activeIndex:-1,activeTriggerCls:"ks-active",steps:1,viewSize:[]};h.getDomEvent=q;h.Plugins=[];c.extend(h.prototype,{_initPlugins:function(){for(var a=this,b=a.constructor;b;)b.Plugins&&c.each(b.Plugins,function(b,c){c.init&&c.init(a)}),b=b.superclass?
b.superclass.constructor:null},_init:function(){var a=this.config;this._parseMarkup();a.hasTriggers&&this._bindTriggers();c.fnbind(this,"beforeSwitch",function(){return true})},_parseMarkup:function(){var a=this.container,b=this.config,e,f,d=[],g=[];switch(b.markupType){case 0:e=c("."+b.navCls,a);e[0]&&(d=c(e).children().get());f=c("."+b.contentCls,a)[0];g=c(f).children().get();break;case 1:d=c("."+b.triggerCls,a).get();g=c("."+b.panelCls,a).get();break;case 2:d=b.triggers,g=b.panels}a=g.length;this.length=
a/b.steps;b.hasTriggers&&a>0&&d.length===0&&(d=this._generateTriggersMarkup(this.length));this.triggers=c.makeArray(d);this.panels=c.makeArray(g);this.content=f||g[0].parentNode;this.nav=e||b.hasTriggers&&d[0].parentNode},_generateTriggersMarkup:function(a){var b=this.config,e=A.createElement("ul"),f,d;e.className=b.navCls;for(d=0;d<a;d++){f=A.createElement("li");if(d===this.activeIndex)f.className=b.activeTriggerCls;f.innerHTML=d+1;e.appendChild(f)}this.container.appendChild(e);return c(e).children().get()},
_bindTriggers:function(){var a=this,b=a.config,e=a.triggers,f,d,g=e.length;for(d=0;d<g;d++)(function(d){f=e[d];c(f).bind("click",function(b){a._onFocusTrigger(d,b)});b.triggerType==="mouse"&&(c(f).bind("mouseenter",function(b){a._onMouseEnterTrigger(d,b)}),c(f).bind("mouseleave",function(){a._onMouseLeaveTrigger(d)}))})(d)},_onFocusTrigger:function(a,b){this._triggerIsValid(a)&&(this._cancelSwitchTimer(),this.switchTo(a,void 0,q(b)))},_onMouseEnterTrigger:function(a,b){var c=this;if(c._triggerIsValid(a)){var f=
q(b);c.switchTimer=w.setTimeout(function(){c.switchTo(a,void 0,f)},c.config.delay*1E3)}},_onMouseLeaveTrigger:function(){this._cancelSwitchTimer()},_triggerIsValid:function(a){return this.activeIndex!==a},_cancelSwitchTimer:function(){if(this.switchTimer)clearTimeout(this.switchTimer),clearInterval(this.switchTimer),this.switchTimer=void 0},switchTo:function(a,b,e,f){var d=this,g=d.config,i=d.triggers,j=d.panels,h=d.activeIndex,k=g.steps,l=h*k,o=a*k;if(!d._triggerIsValid(a))return d;if(c.inArray(c(d).trigger("beforeSwitch",
{toIndex:a}),false)!=-1)return d;g.hasTriggers&&d._switchTrigger(h>-1?i[h]:null,i[a]);b===void 0&&(b=a>h?u:s);d._switchView(h>-1?j.slice(l,l+k):null,j.slice(o,o+k),a,b,e,function(){f&&f.call(d,a);d.completedIndex=a});d.activeIndex=a;return d},_switchTrigger:function(a,b){var e=this.config.activeTriggerCls;a&&c(a).removeClass(e);c(b).addClass(e)},_switchView:function(a,b,e,f,d,g){a&&c(a).css("display","none");c(b).css("display","block");this._fireOnSwitch(e,d);g&&g.call(this)},_fireOnSwitch:function(a,
b){c(this).trigger("switch",c.extend(b||{},{currentIndex:a}))},prev:function(a){var b=this.activeIndex;this.switchTo(b>0?b-1:this.length-1,s,a)},next:function(a){var b=this.activeIndex;this.switchTo(b<this.length-1?b+1:0,u,a)}});c.extend(h.Config,{autoplay:false,interval:5,pauseOnHover:true});h.Plugins.push({name:"autoplay",init:function(a){function b(){d=setInterval(function(){a.paused||a.switchTo(a.activeIndex<a.length-1?a.activeIndex+1:0,"forward")},f)}var e=a.config,f=e.interval*1E3,d;if(e.autoplay)e.pauseOnHover&&
(c(a.container).bind("mouseenter",function(){a.stop()}),c(a.container).bind("mouseleave",function(){a.start()})),b(),a.stop=function(){d&&(clearInterval(d),d=void 0);a.paused=true},a.start=function(){d&&(clearInterval(d),d=void 0);a.paused=false;b()}}});c.extend(h.Config,{effect:"none",duration:0.5,easing:"linear",nativeAnim:true});m=h.Effects={none:function(a,b,e){a&&c(a).css("display","none");c(b).css("display","block");e()},fade:function(a,b,e){a&&a.length!==1&&c.error("fade effect only supports steps == 1.");
var f=this,d=f.config,g=a?a[0]:null,i=b[0];f.anim&&(c(f.anim.fromEl).stop(true),c(f.anim.fromEl).css({zIndex:1,opacity:0}),c(f.anim.toEl).css({zIndex:9}));c(i).css("opacity",1);g?(f.anim={},c(g).stop(true).animate({opacity:0},d.duration*1E3,d.easing,function(){f.anim=void 0;c(i).css("z-index",9);c(g).css("z-index",1);e&&e()}),f.anim.toEl=i,f.anim.fromEl=g):(c(i).css("z-index",9),e&&e())},scroll:function(a,b,e,f){var d=this,b=d.config,g=b.effect===k,i={};i[g?r:x]=-(d.viewSize[g?0:1]*f)+y;d.anim&&c(d.content).stop(true);
a?(d.anim={},c(d.content).stop(true).animate(i,b.duration*1E3,b.easing,function(){d.anim=void 0;e&&e()})):(c(d.content).css(i),e&&e())}};m[k]=m.scrolly=m.scroll;h.Plugins.push({name:"effect",init:function(a){var b=a.config,e=b.effect,f=a.panels,d=a.content,g=b.steps,i=a.activeIndex,h=f.length;a.viewSize=[b.viewSize[0]||f[0].offsetWidth*g,b.viewSize[1]||f[0].offsetHeight*g];if(e!=="none")switch(c.each(f,function(a,b){c(b).css("display","block")}),e){case k:case "scrolly":c(d).css(p,"absolute");c(d.parentNode).css(p,
z);e===k&&(c(f).css("float",r),c(d).width(a.viewSize[0]*(h/g)));break;case "fade":var n=i*g,m=n+g-1,l;c.each(f,function(a,b){l=a>=n&&a<=m;c(b).css({opacity:l?1:0,position:"absolute",zIndex:l?9:1})})}}});c.extend(h.prototype,{_switchView:function(a,b,e,f,d,g){var i=this,h=i.config.effect;(c.isFunction(h)?h:m[h]).call(i,a,b,function(){i._fireOnSwitch(e,d);g&&g.call(i)},e,f)}});c.extend(h.Config,{circular:false});h.Plugins.push({name:"circular",init:function(a){a=a.config;if(a.circular&&(a.effect===
k||a.effect==="scrolly"))a.scrollType=a.effect,a.effect=D}});var H=function(){function a(b,c){if(!(this instanceof a))return new a(b,c);a.superclass.constructor.apply(this,arguments);return 0}c.inherit(a,h,{_init:function(){a.superclass._init.call(this)}});a.Config={effect:"scrollx",autoplay:true};return a}(),I=function(){function a(b,c){if(!(this instanceof a))return new a(b,c);a.superclass.constructor.apply(this,arguments);return 0}c.inherit(a,h,{});a.Config={effect:"none",autoplay:false};return a}(),
J=function(){function a(b,c){if(!(this instanceof a))return new a(b,c);a.superclass.constructor.apply(this,arguments)}a.Config={effect:"scrolly",circular:false,autoplay:true,prevBtnCls:"ks-switchable-prev-btn",nextBtnCls:"ks-switchable-next-btn",disableBtnCls:"ks-switchable-disable-btn"};a.Plugins=[];c.inherit(a,h,{_init:function(){var b=this;a.superclass._init.call(b);var e=b.config,f=e.disableBtnCls,d=false;c.each(["prev","next"],function(a,i){var h=b[i+"Btn"]=c("."+e[i+"BtnCls"],b.container)[0];
h&&c(h).bind("click",function(a){a.preventDefault();if(!d&&!c(h).hasClass(f))b[i](G)})});e.circular||(c.fnbind(b,"beforeSwitch",function(){d=true}),c.fnbind(b,"switch",function(a){a=a.currentIndex;a=a===0?b.prevBtn:a===b.length-1?b.nextBtn:void 0;c([b.prevBtn,b.nextBtn]).removeClass(f);a&&c(a).addClass(f);d=false}));c(b.panels).bind("click",function(){c(b).trigger("itemSelected",{item:this})})}});return a}();c.extend({Widget:function(a){var b=[];c("."+(a||"J_Widget")).each(function(){var a=c(this).data("widget-type"),
f;if(a&&"Switchable Carousel Tab Slide".indexOf(a)>-1)try{(f=c(this).data("widget-config"))&&(f=f.replace(/'/g,'"')),b.push(new c.Widget[a](this,c.parseJSON(f)))}catch(d){c.error("J_Widget: "+d)}});return b}});c.extend(c.Widget,{Switchable:h,Slide:H,Carousel:J,Tab:I});c.each(["Switchable","Carousel","Tab","Slide"],function(a,b){var e={};e[b]=function(a){var d=[];c(this).each(function(){d.push(new c.Widget[b](this,a))});return d};c.fn.extend(e)})})(window,jQuery);
